import pandas as pd
from pathlib import Path
from src.utilities.file import get_project_root_directory


class DataPreprocessor:
    def __init__(self, dataframe: pd.DataFrame = None):
        self.raw_csv_location = get_project_root_directory() / Path('data/interim/extracted_malware_dataset.csv')
        if dataframe is None:
            self.raw_dataframe = pd.read_csv(self.raw_csv_location)
        else:
            self.raw_dataframe = dataframe
        self.preprocessed_csv_location = get_project_root_directory() / Path('data/interim/preprocessed_malware_dataset.csv')

    def shuffle_data(self):
        shuffled_dataframe = self.raw_dataframe.sample(frac=1).reset_index(drop=True)
        self.raw_dataframe = shuffled_dataframe

    def remove_useless_features(self):
        useless_features = ['e_magic', 'Magic', 'Signature', 'Machine', 'TimeDateStamp']
        self.raw_dataframe.drop(useless_features, axis=1, inplace=True)

    def label_encoder(self):
        raw_class = self.raw_dataframe['Class']
        encoded_class = [1 if raw_class[index] == 'malware' else 0 for index in range(len(raw_class))]
        self.raw_dataframe['Class'] = encoded_class

    def drop_nan_samples(self):
        self.raw_dataframe.dropna(inplace=True)

    def save_to_csv(self):
        self.raw_dataframe.to_csv(self.preprocessed_csv_location, index=False)
