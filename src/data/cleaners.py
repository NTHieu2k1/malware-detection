from pathlib import Path
from abc import ABC, abstractmethod


class Cleaner(ABC):
    @abstractmethod
    def get_raw_data_directory(self):
        pass

    @abstractmethod
    def clean_non_pe_files(self):
        pass


class BenignCleaner(Cleaner):
    def __init__(self):
        self.inner_raw_dir = 'data/raw'
        self._full_raw_data_dir = ''

    @property
    def full_raw_data_dir(self):
        return self._full_raw_data_dir

    @full_raw_data_dir.setter
    def full_raw_data_dir(self, new_dir_value):
        self._full_raw_data_dir = new_dir_value

    def get_raw_data_directory(self):
        data_src_directory = Path(__file__)
        project_root_directory = data_src_directory.parent.parent.parent
        self.full_raw_data_dir = project_root_directory / Path(self.inner_raw_dir)

    def clean_non_pe_files(self):
        # Get the list of all data file paths
        all_file_paths = list(Path(self.full_raw_data_dir).glob('**/*.*'))
        # Clear all files that do not have '.exe' & '.msi' extension, but keep the .gitkeep file
        for file_path in all_file_paths:
            if str(file_path).endswith('.gitkeep'):
                continue
            if not (str(file_path).endswith('.exe') or str(file_path).endswith('.msi')):
                file_path.unlink(missing_ok=True)
